<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam - Xamplore</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* CSS Anti-cheat: No selection */
        body {
            user-select: none;
            -webkit-user-select: none;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 h-screen flex flex-col overflow-hidden" oncontextmenu="return false;">

    <!-- Top Bar -->
    <header class="bg-white border-b border-slate-200 px-6 py-3 flex justify-between items-center shadow-sm z-10">
        <div>
            <h1 class="font-bold text-lg" id="testTitle">Loading Test...</h1>
            <p class="text-xs text-slate-500">Do not switch tabs or minimize window.</p>
        </div>
        <div class="flex items-center gap-6">
            <div class="text-right">
                <div class="text-xs text-slate-500 uppercase tracking-wide font-bold">Time Remaining</div>
                <div class="text-xl font-mono font-bold text-blue-600" id="timer">--:--</div>
            </div>
            <button id="submitBtn"
                class="px-6 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition-colors shadow-lg shadow-green-500/20">
                Submit Exam
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex overflow-hidden">
        <!-- Question Palette -->
        <aside class="w-64 bg-slate-100 border-r border-slate-200 p-4 overflow-y-auto hidden md:block">
            <h3 class="font-bold text-slate-700 mb-4">Questions</h3>
            <div class="grid grid-cols-4 gap-2" id="questionPalette">
                <!-- Palette items generated by JS -->
            </div>
        </aside>

        <!-- Question Area -->
        <section class="flex-grow p-6 md:p-10 overflow-y-auto" id="questionArea">
            <div class="max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <div class="mb-6">
                    <span class="text-sm font-bold text-blue-500 mb-1 block">Question <span
                            id="currentQNum">1</span></span>
                    <p class="text-xl font-medium text-slate-800" id="questionText">Loading question...</p>
                </div>

                <div class="space-y-3" id="optionsContainer">
                    <!-- Options generated by JS -->
                </div>

                <div class="mt-8 flex justify-between pt-6 border-t border-slate-100">
                    <button id="prevBtn"
                        class="px-6 py-2 border border-slate-300 rounded-lg font-medium hover:bg-slate-50 text-slate-600">Previous</button>
                    <button id="nextBtn"
                        class="px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">Next</button>
                </div>
            </div>
        </section>
    </main>

    <!-- JS Anti-Cheat & Logic -->
    <script>
        // Anti-Cheat: Tab Switch / Blur Detection
        let warningCount = 0;
        const MAX_WARNINGS = 2;

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                handleViolation("Tab switching detected.");
            }
        });

        window.addEventListener('blur', () => {
            handleViolation("Window focus lost.");
        });

        function handleViolation(reason) {
            warningCount++;
            if (warningCount > MAX_WARNINGS) {
                alert(`Exam Terminated! Reason: ${reason}. Too many violations.`);
                window.location.href = '/exam-failed.html';
                // Trigger auto-submit or fail API call here
            } else {
                alert(`WARNING ${warningCount}/${MAX_WARNINGS}: ${reason}\nDo not switch tabs or minimize the window.`);
            }
        }

        // Disable keys
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey || e.altKey) {
                e.preventDefault(); // Prevent copy/paste shortcuts etc
            }
        });

        // Mock Data Loading (Replace with API)
        const testId = new URLSearchParams(window.location.search).get('id');
        // fetch(`/api/exam/${testId}`)...
    </script>
</body>

</html>
